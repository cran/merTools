<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jared Knowles and Carl Frederick" />

<meta name="date" content="2020-06-22" />

<title>Prediction Intervals from merMod Objects</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Prediction Intervals from merMod Objects</h1>
<h4 class="author">Jared Knowles and Carl Frederick</h4>
<h4 class="date">2020-06-22</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Fitting (generalized) linear mixed models, (G)LMM, to very large data sets is becoming increasingly easy, but understanding and communicating the uncertainty inherent in those models is not. As the documentation for <code>lme4::predict.merMod()</code> notes:</p>
<blockquote>
<p>There is no option for computing standard errors of predictions because it is difficult to define an efficient method that incorporates uncertainty in the variance parameters; we recommend <code>lme4::bootMer()</code> for this task.</p>
</blockquote>
<p>We agree that, short of a fully Bayesian analysis, bootstrapping is the gold-standard for deriving a prediction interval predictions from a (G)LMM, but the time required to obtain even a respectable number of replications from <code>bootMer()</code> quickly becomes prohibitive when the initial model fit is on the order of hours instead of seconds. The only other alternative we have identified for these situations is to use the <code>arm::sim()</code> function to simulate values. Unfortunately, this only takes variation of the fixed coefficients and residuals into account, and assumes the conditional modes of the random effects are fixed.</p>
<p>We developed the <code>predictInterval()</code> function to incorporate the variation in the conditional modes of the random effects (CMRE, a.k.a. BLUPs in the LMM case) into calculating prediction intervals. Ignoring the variance in the CMRE results in overly confident estimates of predicted values and in cases where the precision of the grouping term varies across levels of grouping terms, creates the illusion of difference where none may exist. The importance of accounting for this variance comes into play sharply when comparing the predictions of different models across observations.</p>
<p>We take the warning from <code>lme4::predict.merMod()</code> seriously, but view this method as a decent first approximation the full bootstrap analysis for (G)LMMs fit to very large data sets.</p>
</div>
<div id="conceptual-description" class="section level2">
<h2>Conceptual description</h2>
<p>In order to generate a proper prediction interval, a prediction must account for three sources of uncertainty in mixed models:</p>
<ol style="list-style-type: decimal">
<li>the residual (observation-level) variance,</li>
<li>the uncertainty in the fixed coefficients, and</li>
<li>the uncertainty in the variance parameters for the grouping factors.</li>
</ol>
<p>A fourth, uncertainty about the data, is beyond the scope of any prediction method.</p>
<p>As we mentioned above, the <code>arm:sim()</code> function incorporates the first two sources of variation but not the third , while bootstrapping using <code>lme4::bootMer()</code> does incorporate all three sources of uncertainty because it re-estimates the model using random samples of the data.</p>
<p>When inference about the values of the CMREs is of interest, it would be nice to incorporate some degree of uncertainty in those estimates when comparing observations across groups. <code>predictInterval()</code> does this by drawing values of the CMREs from the conditional variance-covariance matrix of the random affects accessible from <code>lme4::ranef(model, condVar=TRUE)</code>. Thus, <code>predictInterval()</code> incorporates all of the uncertainty from sources one and two, and part of the variance from source 3, but the variance parameters themselves are treated as fixed.</p>
<p>To do this, <code>predictInterval()</code> takes an estimated model of class <code>merMod</code> and, like <code>predict()</code>, a data.frame upon which to make those predictions and:</p>
<ol style="list-style-type: decimal">
<li>extracts the fixed and random coefficients</li>
<li>takes <code>n</code> draws from the multivariate normal distribution of the fixed and random coefficients (separately)</li>
<li>calculates the linear predictor for each row in <code>newdata</code> based on these draws, and</li>
<li>optionally incorporates the residual variation (per the <code>arm::sim()</code> function), and,</li>
<li>returns newdata with the lower and upper limits of the prediction interval and the mean or median of the simulated predictions</li>
</ol>
<p>Currently, the supported model types are linear mixed models and mixed logistic regression models.</p>
<p>The prediction data set <em>can</em> include levels that are not in the estimation model frame. The prediction intervals for such observations only incorporate uncertainty from fixed coefficient estimates and the residual level of variation.</p>
</div>
<div id="comparison-to-existing-methods" class="section level2">
<h2>Comparison to existing methods</h2>
<p>What do the differences between <code>predictInterval()</code> and the other methods for constructing prediction intervals mean in practice? We would expect to see <code>predictInterval()</code> to produce prediction intervals that are wider than all methods except for the <code>bootMer()</code> method. We would also hope that the prediction point estimate from other methods falls within the prediction interval produced by <code>predictInterval()</code>. Ideally, the predicted point estimate produced by <code>predictInterval()</code> would fall close to that produced by <code>bootMer()</code>.</p>
<p>This section compares the results of <code>predictInterval()</code> with those obtained using <code>arm::sim()</code> and <code>lme4::bootMer()</code> using the sleepstudy data from <code>lme4</code>. These data contain reaction time observations for 10 days on 18 subjects. The data are sorted such that the first 10 observations are days one through ten for subject 1, the next 10 are days one through ten for subject 2 and so on. The example model that we are estimating below estimates random intercepts and a random slope for the number of days.</p>
<p>###Step 1: Estimating the model and using <code>predictInterval()</code></p>
<p>First, we will load the required packages and data and estimate the model:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">set.seed</span>(<span class="dv">271828</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">data</span>(sleepstudy)</a>
<a class="sourceLine" id="cb1-3" title="3">fm1 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Reaction <span class="op">~</span><span class="st"> </span>Days <span class="op">+</span><span class="st"> </span>(Days<span class="op">|</span>Subject), <span class="dt">data=</span>sleepstudy)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">display</span>(fm1)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; lmer(formula = Reaction ~ Days + (Days | Subject), data = sleepstudy)</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt;             coef.est coef.se</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; (Intercept) 251.41     6.82 </span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; Days         10.47     1.55 </span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt; Error terms:</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt;  Groups   Name        Std.Dev. Corr </span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt;  Subject  (Intercept) 24.74         </span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt;           Days         5.92    0.07 </span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#&gt;  Residual             25.59         </span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#&gt; number of obs: 180, groups: Subject, 18</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co">#&gt; AIC = 1755.6, DIC = 1760.3</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">#&gt; deviance = 1751.9</span></a></code></pre></div>
<p>Then, calculate prediction intervals using <code>predictInterval()</code>. The <code>predictInterval</code> function has a number of user configurable options. In this example, we use the original data <code>sleepstudy</code> as the newdata. We pass the function the <code>fm1</code> model we fit above. We also choose a 95% interval with <code>level = 0.95</code>, though we could choose a less conservative prediction interval. We make 1,000 simulations for each observation <code>n.sims = 1000</code>. We set the point estimate to be the median of the simulated values, instead of the mean. We ask for the linear predictor back, if we fit a logistic regression, we could have asked instead for our predictions on the probability scale instead. Finally, we indicate that we want the predictions to incorporate the residual variance from the model – an option only available for <code>lmerMod</code> objects.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">PI.time &lt;-<span class="st"> </span><span class="kw">system.time</span>(</a>
<a class="sourceLine" id="cb2-2" title="2">  PI &lt;-<span class="st"> </span><span class="kw">predictInterval</span>(<span class="dt">merMod =</span> fm1, <span class="dt">newdata =</span> sleepstudy,</a>
<a class="sourceLine" id="cb2-3" title="3">                        <span class="dt">level =</span> <span class="fl">0.95</span>, <span class="dt">n.sims =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb2-4" title="4">                        <span class="dt">stat =</span> <span class="st">&quot;median&quot;</span>, <span class="dt">type=</span><span class="st">&quot;linear.prediction&quot;</span>,</a>
<a class="sourceLine" id="cb2-5" title="5">                        <span class="dt">include.resid.var =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-6" title="6">)</a></code></pre></div>
<p>Here is the first few rows of the object <code>PI</code>:</p>
<table>
<thead>
<tr class="header">
<th align="right">fit</th>
<th align="right">upr</th>
<th align="right">lwr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">251.6685</td>
<td align="right">311.3171</td>
<td align="right">196.4096</td>
</tr>
<tr class="even">
<td align="right">271.4802</td>
<td align="right">330.9195</td>
<td align="right">214.2175</td>
</tr>
<tr class="odd">
<td align="right">292.6809</td>
<td align="right">350.9867</td>
<td align="right">237.7714</td>
</tr>
<tr class="even">
<td align="right">311.6967</td>
<td align="right">369.2911</td>
<td align="right">254.2237</td>
</tr>
<tr class="odd">
<td align="right">331.8318</td>
<td align="right">389.7439</td>
<td align="right">278.1857</td>
</tr>
<tr class="even">
<td align="right">350.7450</td>
<td align="right">408.1386</td>
<td align="right">294.8506</td>
</tr>
</tbody>
</table>
<p>The three columns are the median (<code>fit</code>) and limits of the 95% prediction interval (<code>upr</code> and <code>lwr</code>) because we set <code>level=0.95</code>. The following figure displays the output graphically for the first 30 observations.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">library</span>(ggplot2);</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dt">y=</span>fit, <span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr), <span class="dt">data=</span>PI[<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>,]) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="st">  </span><span class="kw">geom_linerange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Index&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Prediction w/ 95% PI&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="data:image/png;base64,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" title="plot of chunk Inspect_predInt_2" alt="plot of chunk Inspect_predInt_2" style="display: block; margin: auto;" /></p>
<div id="step-1a-adjusting-for-correlation-between-fixed-and-random-effects" class="section level4">
<h4>Step 1a: Adjusting for correlation between fixed and random effects</h4>
<p>The prediction intervals above do not correct for correlations between fixed and random effects. This tends to lead to predictive intervals that are too conservative, especially for existing groups when there is a lot of data on relatively few groups. In that case, a significant portion of the uncertainty in the prediction can be due to variance in the fixed intercept which is anti-correlated with variance in the random intercept effects. For instance, it does not actually matter if the fixed intercept is 5 and the random intercept effects are -2, 1, and 1, versus a fixed intercept of 6 and random intercept effects of -3, 0, and 0. (The latter situation will never be the MLE, but it can occur in this package’s simulations.)</p>
<p>To show this issue, we’ll use the sleep study model, predicting the reaction times of subjects after experiencing sleep deprivation:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">fm1 &lt;-<span class="st"> </span><span class="kw">lmer</span>(Reaction <span class="op">~</span><span class="st"> </span>Days <span class="op">+</span><span class="st"> </span>(Days<span class="op">|</span>Subject), <span class="dt">data=</span>sleepstudy)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">display</span>(fm1)</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; lmer(formula = Reaction ~ Days + (Days | Subject), data = sleepstudy)</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt;             coef.est coef.se</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt; (Intercept) 251.41     6.82 </span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt; Days         10.47     1.55 </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; Error terms:</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt;  Groups   Name        Std.Dev. Corr </span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt;  Subject  (Intercept) 24.74         </span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt;           Days         5.92    0.07 </span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt;  Residual             25.59         </span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt; number of obs: 180, groups: Subject, 18</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; AIC = 1755.6, DIC = 1760.3</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt; deviance = 1751.9</span></a></code></pre></div>
<p>Let’s use the model to give an interval for the true average body fat of a large group of students like the first one in the study — a 196cm female baseball player:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">sleepstudy[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt;   Reaction Days Subject</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; 1   249.56    0     308</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">predictInterval</span>(fm1, sleepstudy[<span class="dv">1</span>,], <span class="dt">include.resid.var=</span><span class="dv">0</span>) <span class="co">#predict the average body fat for a group of 196cm female baseball players</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt;        fit      upr      lwr</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; 1 253.9977 270.7438 236.2829</span></a></code></pre></div>
<p>There are two ways to get predictInterval to create less-conservative intervals to deal with this. The first is just to tell it to consider certain fixed effects as fully-known (that is, with an effectively 0 variance.) This is done using the <code>ignore.fixed.effects</code> argument.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">predictInterval</span>(fm1, sleepstudy[<span class="dv">1</span>,], <span class="dt">include.resid.var=</span><span class="dv">0</span>, <span class="dt">ignore.fixed.terms =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#&gt;        fit      upr      lwr</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt; 1 253.8537 268.5299 239.6275</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co"># predict the average reaction time for a subject at day 0, taking the global intercept</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co"># (mean reaction time) as fully known</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="kw">predictInterval</span>(fm1, sleepstudy[<span class="dv">1</span>,], <span class="dt">include.resid.var=</span><span class="dv">0</span>, <span class="dt">ignore.fixed.terms =</span> <span class="st">&quot;(Intercept)&quot;</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt;        fit      upr      lwr</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; 1 254.2354 269.3875 239.3116</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#Same as above</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="kw">predictInterval</span>(fm1, sleepstudy[<span class="dv">1</span>,], <span class="dt">include.resid.var=</span><span class="dv">0</span>, <span class="dt">ignore.fixed.terms =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt;        fit      upr     lwr</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt; 1 253.6743 269.8776 237.984</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co"># as above, taking the first two fixed effects (intercept and days effect) as fully known</span></a></code></pre></div>
<p>The second way is to use an ad-hoc variance adjustment, with the <code>fix.intercept.variance</code> argument. This takes the model’s intercept variance <span class="math inline">\(\hat\sigma^2_\mu\)</span> and adjusts it to:</p>
<p><span class="math display">\[\hat\sigma\prime^2_\mu = \hat\sigma^2_\mu-\Sigma_{levels}\frac{1}{\Sigma_{groups(level)}1/(\hat\sigma^2_{level}+sigma^2_{group})}\]</span></p>
<p>In other words, it assumes the given intercept variance incorporates spurious variance for each level, where each of the spurious variance terms has a precision equal to the of the precisions due to the individual groups at that level.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">predictInterval</span>(fm1, sleepstudy[<span class="dv">1</span>,], <span class="dt">include.resid.var=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb7-2" title="2">                <span class="dt">fix.intercept.variance =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt;        fit      upr      lwr</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt; 1 253.5872 268.8683 236.6639</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co"># predict the average reaction time for a subject at day 0,, using an ad-hoc</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co"># correction for the covariance of the intercept with the random intercept effects.</span></a></code></pre></div>
<p>A few notes about these two arguments:</p>
<ul>
<li><code>fix.intercept.variance=T</code> is redundant with <code>ignore.fixed.effects=1</code>, but not vice versa.</li>
<li>These corrections should NOT be used when predicting outcomes for groups not present in the original data.</li>
</ul>
</div>
<div id="step-2-comparison-with-armsim" class="section level3">
<h3>Step 2: Comparison with <code>arm::sim()</code></h3>
<p>How does the output above compare to what we could get from <code>arm::sim()</code>?</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">PI.arm.time &lt;-<span class="st"> </span><span class="kw">system.time</span>(</a>
<a class="sourceLine" id="cb8-2" title="2">  PI.arm.sims &lt;-<span class="st"> </span>arm<span class="op">::</span><span class="kw">sim</span>(fm1, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb8-3" title="3">)</a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5">PI.arm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="dt">fit=</span><span class="kw">apply</span>(<span class="kw">fitted</span>(PI.arm.sims, fm1), <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">quantile</span>(x, <span class="fl">0.500</span>)),</a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="dt">upr=</span><span class="kw">apply</span>(<span class="kw">fitted</span>(PI.arm.sims, fm1), <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">quantile</span>(x, <span class="fl">0.975</span>)),</a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="dt">lwr=</span><span class="kw">apply</span>(<span class="kw">fitted</span>(PI.arm.sims, fm1), <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">quantile</span>(x, <span class="fl">0.025</span>))</a>
<a class="sourceLine" id="cb8-9" title="9">)</a>
<a class="sourceLine" id="cb8-10" title="10"></a>
<a class="sourceLine" id="cb8-11" title="11">comp.data &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;predictInterval()&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI))<span class="op">-</span><span class="fl">0.1</span>, PI),</a>
<a class="sourceLine" id="cb8-12" title="12">                   <span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;arm::sim()&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI.arm))<span class="op">+</span><span class="fl">0.1</span>, PI.arm))</a>
<a class="sourceLine" id="cb8-13" title="13"></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>fit, <span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr, <span class="dt">color=</span>Predict.Method), <span class="dt">data=</span>comp.data[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>,<span class="dv">181</span><span class="op">:</span><span class="dv">210</span>),]) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="st">  </span><span class="kw">geom_linerange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Index&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Prediction w/ 95% PI&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="dt">palette =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" title="plot of chunk arm.Sim" alt="plot of chunk arm.Sim" style="display: block; margin: auto;" /></p>
<p>The prediction intervals from <code>arm:sim()</code> are much smaller and the random slope for days vary more than they do for <code>predictInterval</code>. Both results are as expected, given the small number of subjects and observations per subject in these data. Because <code>predictInterval()</code> is incorporating uncertainty in the CMFEs (but not the variance parameters of the random coefficients themselves), the Days slopes are closer to the overall or pooled regression slope.</p>
<p>###Step 3: Comparison with <code>lme4::bootMer()</code></p>
<p>As quoted above, the developers of lme4 suggest that users interested in uncertainty estimates around their predictions use <code>lme4::bootmer()</code> to calculate them. The documentation for <code>lme4::bootMer()</code> goes on to describe three implemented flavors of bootstrapped estimates:</p>
<ol style="list-style-type: decimal">
<li>parametrically resampling both the <em>“spherical”</em> random effects <em>u</em> and the i.i.d. errors <span class="math inline">\(\epsilon\)</span></li>
<li>treating the random effects as fixed and parametrically resampling the i.i.d. errors</li>
<li>treating the random effects as fixed and semi-parametrically resampling the i.i.d. errors from the distribution of residuals.</li>
</ol>
<p>We will compare the results from <code>predictInterval()</code> with each method, in turn.</p>
<div id="step-3a-lme4bootmer-method-1" class="section level4">
<h4>Step 3a: <code>lme4::bootMer()</code> method 1</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co">##Functions for bootMer() and objects</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">####Return predicted values from bootstrap</span></a>
<a class="sourceLine" id="cb9-3" title="3">mySumm &lt;-<span class="st"> </span><span class="cf">function</span>(.) {</a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="kw">predict</span>(., <span class="dt">newdata=</span>sleepstudy, <span class="dt">re.form=</span><span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb9-5" title="5">}</a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">####Collapse bootstrap into median, 95% PI</span></a>
<a class="sourceLine" id="cb9-7" title="7">sumBoot &lt;-<span class="st"> </span><span class="cf">function</span>(merBoot) {</a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="kw">return</span>(</a>
<a class="sourceLine" id="cb9-9" title="9">    <span class="kw">data.frame</span>(<span class="dt">fit =</span> <span class="kw">apply</span>(merBoot<span class="op">$</span>t, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">as.numeric</span>(<span class="kw">quantile</span>(x, <span class="dt">probs=</span>.<span class="dv">5</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))),</a>
<a class="sourceLine" id="cb9-10" title="10">               <span class="dt">lwr =</span> <span class="kw">apply</span>(merBoot<span class="op">$</span>t, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">as.numeric</span>(<span class="kw">quantile</span>(x, <span class="dt">probs=</span>.<span class="dv">025</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))),</a>
<a class="sourceLine" id="cb9-11" title="11">               <span class="dt">upr =</span> <span class="kw">apply</span>(merBoot<span class="op">$</span>t, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">as.numeric</span>(<span class="kw">quantile</span>(x, <span class="dt">probs=</span>.<span class="dv">975</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb9-12" title="12">    )</a>
<a class="sourceLine" id="cb9-13" title="13">  )</a>
<a class="sourceLine" id="cb9-14" title="14">}</a>
<a class="sourceLine" id="cb9-15" title="15"></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">##lme4::bootMer() method 1</span></a>
<a class="sourceLine" id="cb9-17" title="17">PI.boot1.time &lt;-<span class="st"> </span><span class="kw">system.time</span>(</a>
<a class="sourceLine" id="cb9-18" title="18">  boot1 &lt;-<span class="st"> </span>lme4<span class="op">::</span><span class="kw">bootMer</span>(fm1, mySumm, <span class="dt">nsim=</span><span class="dv">250</span>, <span class="dt">use.u=</span><span class="ot">FALSE</span>, <span class="dt">type=</span><span class="st">&quot;parametric&quot;</span>)</a>
<a class="sourceLine" id="cb9-19" title="19">)</a>
<a class="sourceLine" id="cb9-20" title="20"></a>
<a class="sourceLine" id="cb9-21" title="21">PI.boot1 &lt;-<span class="st"> </span><span class="kw">sumBoot</span>(boot1)</a>
<a class="sourceLine" id="cb9-22" title="22"></a>
<a class="sourceLine" id="cb9-23" title="23">comp.data &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;predictInterval()&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI))<span class="op">-</span><span class="fl">0.1</span>, PI),</a>
<a class="sourceLine" id="cb9-24" title="24">                   <span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;lme4::bootMer() - Method 1&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI.boot1))<span class="op">+</span><span class="fl">0.1</span>, PI.boot1))</a>
<a class="sourceLine" id="cb9-25" title="25"></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>fit, <span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr, <span class="dt">color=</span>Predict.Method), <span class="dt">data=</span>comp.data[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>,<span class="dv">181</span><span class="op">:</span><span class="dv">210</span>),]) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="st">  </span><span class="kw">geom_linerange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-29" title="29"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Index&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Prediction w/ 95% PI&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-30" title="30"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="dt">palette =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" title="plot of chunk bootMer.1" alt="plot of chunk bootMer.1" style="display: block; margin: auto;" /></p>
<p>The intervals produced by <code>predictInterval</code>, represented in green, cover the point estimates produced by <code>bootMer</code> in every case for these 30 observations. Additionally, in almost every case, the <code>predictInterval</code> encompasses the entire interval presented by <code>bootMer</code>. Here, the estimates produced by <code>bootMer</code> are re-estimating the group terms, but by refitting the model, they are also taking into account the conditional variance of these terms, or <code>theta</code>, and provide tighter prediction intervals than the <code>predictInterval</code> method.</p>
<p>####Step 3b: <code>lme4::bootMer()</code> method 2</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co">##lme4::bootMer() method 2</span></a>
<a class="sourceLine" id="cb10-2" title="2">PI.boot2.time &lt;-<span class="st"> </span><span class="kw">system.time</span>(</a>
<a class="sourceLine" id="cb10-3" title="3">  boot2 &lt;-<span class="st"> </span>lme4<span class="op">::</span><span class="kw">bootMer</span>(fm1, mySumm, <span class="dt">nsim=</span><span class="dv">250</span>, <span class="dt">use.u=</span><span class="ot">TRUE</span>, <span class="dt">type=</span><span class="st">&quot;parametric&quot;</span>)</a>
<a class="sourceLine" id="cb10-4" title="4">)</a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6">PI.boot2 &lt;-<span class="st"> </span><span class="kw">sumBoot</span>(boot2)</a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8">comp.data &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;predictInterval()&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI))<span class="op">-</span><span class="fl">0.1</span>, PI),</a>
<a class="sourceLine" id="cb10-9" title="9">                   <span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;lme4::bootMer() - Method 2&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI.boot2))<span class="op">+</span><span class="fl">0.1</span>, PI.boot2))</a>
<a class="sourceLine" id="cb10-10" title="10"></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>fit, <span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr, <span class="dt">color=</span>Predict.Method), <span class="dt">data=</span>comp.data[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>,<span class="dv">181</span><span class="op">:</span><span class="dv">210</span>),]) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="st">  </span><span class="kw">geom_linerange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Index&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Prediction w/ 95% PI&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="dt">palette =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" title="plot of chunk bootMer.2" alt="plot of chunk bootMer.2" style="display: block; margin: auto;" /></p>
<p>Here, the results for <code>predictInterval</code> in green again encompass the results from <code>bootMer</code>, but are much wider. The <code>bootMer</code> estimates are ignoring the variance in the group effects, and as such, are only incorporating the residual variance and the variance in the fixed effects – similar to the <code>arm::sim()</code> function.</p>
</div>
<div id="step-3c-lme4bootmer-method-3" class="section level4">
<h4>Step 3c: <code>lme4::bootMer()</code> method 3</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co">##lme4::bootMer() method 3</span></a>
<a class="sourceLine" id="cb11-2" title="2">PI.boot3.time &lt;-<span class="st"> </span><span class="kw">system.time</span>(</a>
<a class="sourceLine" id="cb11-3" title="3">  boot3 &lt;-<span class="st"> </span>lme4<span class="op">::</span><span class="kw">bootMer</span>(fm1, mySumm, <span class="dt">nsim=</span><span class="dv">250</span>, <span class="dt">use.u=</span><span class="ot">TRUE</span>, <span class="dt">type=</span><span class="st">&quot;semiparametric&quot;</span>)</a>
<a class="sourceLine" id="cb11-4" title="4">)</a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6">PI.boot3 &lt;-<span class="st"> </span><span class="kw">sumBoot</span>(boot3)</a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">comp.data &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;predictInterval()&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI))<span class="op">-</span><span class="fl">0.1</span>, PI),</a>
<a class="sourceLine" id="cb11-9" title="9">                   <span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;lme4::bootMer() - Method 3&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI.boot3))<span class="op">+</span><span class="fl">0.1</span>, PI.boot3))</a>
<a class="sourceLine" id="cb11-10" title="10"></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>fit, <span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr, <span class="dt">color=</span>Predict.Method), <span class="dt">data=</span>comp.data[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>,<span class="dv">181</span><span class="op">:</span><span class="dv">210</span>),]) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="st">  </span><span class="kw">geom_linerange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Index&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Prediction w/ 95% PI&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="dt">palette =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" title="plot of chunk bootMer.3" alt="plot of chunk bootMer.3" style="display: block; margin: auto;" /></p>
<p>These results are virtually identical to those above.</p>
</div>
<div id="step-3c-comparison-to-rstanarm" class="section level4">
<h4>Step 3c: Comparison to rstanarm</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">PI.time.stan &lt;-<span class="st"> </span><span class="kw">system.time</span>({</a>
<a class="sourceLine" id="cb12-2" title="2">  fm_stan &lt;-<span class="st"> </span><span class="kw">stan_lmer</span>(Reaction <span class="op">~</span><span class="st"> </span>Days <span class="op">+</span><span class="st"> </span>(Days<span class="op">|</span>Subject), <span class="dt">data =</span> sleepstudy,</a>
<a class="sourceLine" id="cb12-3" title="3">                       <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">open_progress =</span> <span class="ot">FALSE</span>, <span class="dt">refresh =</span> <span class="dv">-1</span>,</a>
<a class="sourceLine" id="cb12-4" title="4">                       <span class="dt">show_messages=</span><span class="ot">FALSE</span>, <span class="dt">chains =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-5" title="5">  zed &lt;-<span class="st"> </span><span class="kw">posterior_predict</span>(fm_stan)</a>
<a class="sourceLine" id="cb12-6" title="6">  PI.stan &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">apply</span>(zed, <span class="dv">2</span>, median), <span class="kw">central_intervals</span>(zed, <span class="dt">prob=</span><span class="fl">0.95</span>))</a>
<a class="sourceLine" id="cb12-7" title="7">})</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; Chain 1: Gradient evaluation took 0 seconds</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0 seconds.</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt; Chain 1: </span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; Chain 1:  Elapsed Time: 6.994 seconds (Warm-up)</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt; Chain 1:                2.497 seconds (Sampling)</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; Chain 1:                9.491 seconds (Total)</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&gt; Chain 1:</span></a>
<a class="sourceLine" id="cb12-19" title="19"></a>
<a class="sourceLine" id="cb12-20" title="20"></a>
<a class="sourceLine" id="cb12-21" title="21"><span class="kw">print</span>(fm_stan)</a>
<a class="sourceLine" id="cb12-22" title="22"><span class="co">#&gt; stan_lmer</span></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="co">#&gt;  family:       gaussian [identity]</span></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="co">#&gt;  formula:      Reaction ~ Days + (Days | Subject)</span></a>
<a class="sourceLine" id="cb12-25" title="25"><span class="co">#&gt;  observations: 180</span></a>
<a class="sourceLine" id="cb12-26" title="26"><span class="co">#&gt; ------</span></a>
<a class="sourceLine" id="cb12-27" title="27"><span class="co">#&gt;             Median MAD_SD</span></a>
<a class="sourceLine" id="cb12-28" title="28"><span class="co">#&gt; (Intercept) 251.5    6.4 </span></a>
<a class="sourceLine" id="cb12-29" title="29"><span class="co">#&gt; Days         10.5    1.7 </span></a>
<a class="sourceLine" id="cb12-30" title="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-31" title="31"><span class="co">#&gt; Auxiliary parameter(s):</span></a>
<a class="sourceLine" id="cb12-32" title="32"><span class="co">#&gt;       Median MAD_SD</span></a>
<a class="sourceLine" id="cb12-33" title="33"><span class="co">#&gt; sigma 25.9    1.6  </span></a>
<a class="sourceLine" id="cb12-34" title="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-35" title="35"><span class="co">#&gt; Error terms:</span></a>
<a class="sourceLine" id="cb12-36" title="36"><span class="co">#&gt;  Groups   Name        Std.Dev. Corr</span></a>
<a class="sourceLine" id="cb12-37" title="37"><span class="co">#&gt;  Subject  (Intercept) 23.8         </span></a>
<a class="sourceLine" id="cb12-38" title="38"><span class="co">#&gt;           Days         6.9     0.09</span></a>
<a class="sourceLine" id="cb12-39" title="39"><span class="co">#&gt;  Residual             26.0         </span></a>
<a class="sourceLine" id="cb12-40" title="40"><span class="co">#&gt; Num. levels: Subject 18 </span></a>
<a class="sourceLine" id="cb12-41" title="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-42" title="42"><span class="co">#&gt; ------</span></a>
<a class="sourceLine" id="cb12-43" title="43"><span class="co">#&gt; * For help interpreting the printed output see ?print.stanreg</span></a>
<a class="sourceLine" id="cb12-44" title="44"><span class="co">#&gt; * For info on the priors used see ?prior_summary.stanreg</span></a>
<a class="sourceLine" id="cb12-45" title="45"></a>
<a class="sourceLine" id="cb12-46" title="46">PI.stan &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(PI.stan)</a>
<a class="sourceLine" id="cb12-47" title="47"><span class="kw">names</span>(PI.stan) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;lwr&quot;</span>, <span class="st">&quot;upr&quot;</span>)</a>
<a class="sourceLine" id="cb12-48" title="48">PI.stan &lt;-<span class="st"> </span>PI.stan[, <span class="kw">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;upr&quot;</span>, <span class="st">&quot;lwr&quot;</span>)]</a>
<a class="sourceLine" id="cb12-49" title="49">comp.data &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;predictInterval()&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI))<span class="op">-</span><span class="fl">0.1</span>, PI),</a>
<a class="sourceLine" id="cb12-50" title="50">                   <span class="kw">data.frame</span>(<span class="dt">Predict.Method=</span><span class="st">&quot;rstanArm&quot;</span>, <span class="dt">x=</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(PI.stan))<span class="op">+</span><span class="fl">0.1</span>, PI.stan))</a>
<a class="sourceLine" id="cb12-51" title="51"></a>
<a class="sourceLine" id="cb12-52" title="52"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>fit, <span class="dt">ymin=</span>lwr, <span class="dt">ymax=</span>upr, <span class="dt">color=</span>Predict.Method), <span class="dt">data=</span>comp.data[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>,<span class="dv">181</span><span class="op">:</span><span class="dv">210</span>),]) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-53" title="53"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb12-54" title="54"><span class="st">  </span><span class="kw">geom_linerange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb12-55" title="55"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Index&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Prediction w/ 95% PI&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-56" title="56"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-57" title="57"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="dt">palette =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" title="plot of chunk stancomp" alt="plot of chunk stancomp" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="computation-time" class="section level3">
<h3>Computation time</h3>
<p>Our initial motivation for writing this function was to develop a method for incorporating uncertainty in the CMFEs for mixed models estimated on very large samples. Even for models with only modest degrees of complexity, using <code>lme4::bootMer()</code> quickly becomes time prohibitive because it involves re-estimating the model for each simulation. We have seen how each alternative compares to <code>predictInterval()</code> substantively, but how do they compare in terms of computational time? The table below lists the output of <code>system.time()</code> for all five methods for calculating prediction intervals for <code>merMod</code> objects.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">elapsed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">predictInterval()</td>
<td align="right">0.30</td>
<td align="right">0.01</td>
<td align="right">0.31</td>
</tr>
<tr class="even">
<td align="left">arm::sim()</td>
<td align="right">0.56</td>
<td align="right">0.00</td>
<td align="right">0.56</td>
</tr>
<tr class="odd">
<td align="left">lme4::bootMer()-Method 1</td>
<td align="right">5.79</td>
<td align="right">0.08</td>
<td align="right">5.92</td>
</tr>
<tr class="even">
<td align="left">lme4::bootMer()-Method 2</td>
<td align="right">6.03</td>
<td align="right">0.05</td>
<td align="right">6.13</td>
</tr>
<tr class="odd">
<td align="left">lme4::bootMer()-Method 3</td>
<td align="right">5.93</td>
<td align="right">0.01</td>
<td align="right">6.05</td>
</tr>
<tr class="even">
<td align="left">rstanarm:predict</td>
<td align="right">10.09</td>
<td align="right">0.05</td>
<td align="right">10.19</td>
</tr>
</tbody>
</table>
<p>For this simple example, we see that <code>arm::sim()</code> is the fastest–nearly five times faster than <code>predictInterval()</code>. However, <code>predictInterval()</code> is nearly six times faster than any of the bootstrapping options via <code>lme4::bootMer</code>. This may not seem like a lot, but consider that the computational time for required for bootstrapping is roughly proportional to the number of bootstrapped simulations requested … <code>predictInterval()</code> is not because it is just a series of draws from various multivariate normal distributions, so the time ratios in the table below represents the lowest bound of the computation time ratio of bootstrapping to <code>predictInterval()</code>.</p>
</div>
</div>
<div id="simulation" class="section level2">
<h2>Simulation</h2>
<p>TBC.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
